// 84
[proc,rebuildchatbox](int $int0)
def_int $int1 = if_getwidth(interface_162:com43);
def_string $string0 = removetags(chat_playername);
def_int $int2 = 0;
if (%varclient_41 = 3) {
    $int2 = 1;
}
def_int $rgb3 = ^black;
def_boolean $boolean4 = false;
def_string $string1 = "<col=0000ff>";
def_string $string2 = "<col=7f0000>";
def_string $string3 = "<col=2020ef>";
def_string $string4 = "<col=004f00>";
def_string $string5 = "<col=0000ff>";
def_string $string6 = "<col=7f0000>";
def_string $string7 = "<col=7f007f>";
def_string $string8 = "<col=7e3200>";
if (~toplevel_chatbox_maketransparent = true) {
    $rgb3, $boolean4 = ^white, true;
    $string1, $string2, $string3, $string4 = "<col=9090ff>", "<col=bf2020>", "<col=4040ff>", "<col=30ff30>";
    $string5, $string6, $string7, $string8 = "<col=9070ff>", "<col=ef5050>", "<col=df20ff>", "<col=ff20df>";
}
def_int $int5 = 0;
def_int $int6 = 0;
def_int $int7 = 0;
def_component $component8 = enum(int, component, enum_579, $int7);
if ((%varclient_41 = 0 | %varclient_41 = 2) & string_length(chat_getmessagefilter) > 0) {
    $int6 = ~script199("<$string1>Public chat filtering:</col> <lt><lowercase(escape(chat_getmessagefilter))><gt>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
    if_clearops($component8);
    $int5 = calc($int5 - $int6);
    $int7 = calc($int7 + 1);
    $component8 = enum(int, component, enum_579, $int7);
}
def_int $int9 = $int0;
def_int $chattype10 = ^chattype_gamemessage;
def_int $int11 = -1;
def_string $string9 = "";
def_string $string10 = "";
def_string $string11 = "";
while ($int9 ! -1 & $component8 ! null) {
    $chattype10, $int11, $string9, $string10, $string11 = chat_gethistory_byuid($int9);
    if (~panetest($chattype10, $string9) = true & ~filtertest($chattype10, $string9, $string11, $int11, $int2, $string0) = true) {
        if ($chattype10 = ^chattype_publicchat | $chattype10 = ^chattype_modchat) {
            $int6 = ~script203("<$string9>:", "<$string1><$string11></col>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        } else if ($chattype10 = ^chattype_autotyper | $chattype10 = ^chattype_modautotyper) {
            $int6 = ~script203("<$string9>:", "<$string3><$string11></col>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        } else if ($chattype10 = ^chattype_privatechat | $chattype10 = ^chattype_modprivatechat) {
            $int6 = ~script203("From <$string9>:", "<$string2><$string11></col>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        } else if ($chattype10 = ^chattype_tradereq) {
            $int6 = ~script199("<$string7><$string11></col>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        } else if ($chattype10 = ^chattype_loginlogoutnotification) {
            $int6 = ~script199("<$string2><$string11></col>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
            if (%varplayerbit_1627 = 0) {
                %varclient_65 = calc($int11 + 500 + 1);
                if_setontimer("script664(false)", interface_162:com0);
            }
        } else if ($chattype10 = ^chattype_privatechatout) {
            $int6 = ~script203("To <$string9>:", "<$string2><$string11></col>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        } else if ($chattype10 = ^chattype_chalreq_trade | $chattype10 = ^chattype_chalreq_friendschat) {
            $int6 = ~script199("<$string8><$string11></col>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        } else if ($chattype10 = ^chattype_friendschat) {
            $int6 = ~script203("[<$string5><$string10></col>] <$string9>:", "<$string6><$string11></col>", $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        } else if ($chattype10 = ^chattype_broadcast) {
            $int6 = ~script203("<$string4>Broadcast:</col>", $string11, $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        } else {
            $int6 = ~script199($string11, $int7, $component8, interface_162:com43, $int1, 3, 14, $int5, ^setposv_abs_top, $rgb3, $boolean4);
        }
        if_clearops($component8);
        if ($chattype10 = ^chattype_modchat | $chattype10 = ^chattype_publicchat | $chattype10 = ^chattype_privatechat | $chattype10 = ^chattype_privatechatout | $chattype10 = ^chattype_modprivatechat | $chattype10 = ^chattype_friendschat | $chattype10 = ^chattype_autotyper | $chattype10 = ^chattype_modautotyper | $chattype10 = ^chattype_playerrelated) {
            if_setopbase("<col=ffffff><$string9>", $component8);
            if (compare($string0, removetags($string9)) ! 0) {
                if (friend_test($string9) = true) {
                    if_setop(6, "Message", $component8);
                } else {
                    if_setop(6, "Add friend", $component8);
                    if_setop(7, "Add ignore", $component8);
                }
                if_setop(8, "Report", $component8);
                if ($chattype10 = ^chattype_friendschat & clan_getchatcount > 0 & clan_getchatrank >= clan_getchatminkick) {
                    if_setop(9, "Kick", $component8);
                }
            }
        } else if ($chattype10 = ^chattype_tradereq) {
            if_setopbase("<col=ffffff><$string9>", $component8);
            if_setop(1, "Accept trade", $component8);
        } else if ($chattype10 = ^chattype_chalreq_trade | $chattype10 = ^chattype_chalreq_friendschat) {
            if_setopbase("<col=ffffff><$string9>", $component8);
            if_setop(2, "Accept challenge", $component8);
        }
        $int5 = calc($int5 - $int6);
        $int7 = calc($int7 + 1);
        $component8 = enum(int, component, enum_579, $int7);
    }
    $int9 = chat_getprevuid($int9);
}
def_int $int12 = $int7;
while ($component8 ! null) {
    if_clearops($component8);
    if_setsize(0, 0, ^setsize_abs, ^setsize_abs, $component8);
    if (cc_find(interface_162:com43, calc($int7 * 2)) = ^true) {
        cc_settext("");
        cc_sethide(true);
    }
    if (cc_find(interface_162:com43, calc($int7 * 2 + 1)) = ^true) {
        cc_settext("");
        cc_sethide(true);
    }
    $int7 = calc($int7 + 1);
    $component8 = enum(int, component, enum_579, $int7);
}
$int5 = calc($int5 - 2);
$int5 = calc(0 - $int5);
def_int $int13 = if_getheight(interface_162:com43);
if ($int5 > $int13) {
    $int13 = $int5;
}
$int7 = $int12;
while ($int7 > 0) {
    $int7 = calc($int7 - 1);
    $component8 = enum(int, component, enum_579, $int7);
    $int5 = calc(if_gety($component8) + $int13 - 2);
    if_setposition(if_getx($component8), $int5, ^setposh_abs_left, ^setposv_abs_top, $component8);
    if (cc_find(interface_162:com43, calc($int7 * 2)) = ^true) {
        cc_setposition(cc_getx, $int5, ^setposh_abs_left, ^setposv_abs_top);
    }
    if (cc_find(interface_162:com43, calc($int7 * 2 + 1)) = ^true) {
        cc_setposition(cc_getx, $int5, ^setposh_abs_left, ^setposv_abs_top);
    }
}
if_setscrollsize(0, $int13, interface_162:com43);
~scrollbar_resize(interface_162:com544, interface_162:com43, calc(%varclient_7 + ($int13 - %varclient_8)));
%varclient_7, %varclient_8 = if_getscrolly(interface_162:com43), $int13;
